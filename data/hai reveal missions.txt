# Copyright (c) ???? by Michael Zahniser
#
# Endless Sky is free software: you can redistribute it and/or modify it under the
# terms of the GNU General Public License as published by the Free Software
# Foundation, either version 3 of the License, or (at your option) any later version.
#
# Endless Sky is distributed in the hope that it will be useful, but WITHOUT ANY
# WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
# PARTICULAR PURPOSE.  See the GNU General Public License for more details.

mission "hai secret leaker begins"
	landing
	invisible
	to offer
		has "free worlds plot completed"
	on offer
		event "pug media coverage" 20 30
		fail

event "pug media coverage"

mission "event: pug media coverage"
	landing
	source
		government "Republic" "Syndicate" "Free Worlds"
		attributes "spaceport"
	to offer
		has "event: pug media coverage"
	on offer
		conversation
			`It's been weeks now but as you walk through the spaceport you can't help but notice that coverage on the events of the Pug invasion still continues to dominate headlines.`
			`	As you look around you see that experts and officials have given way to talking heads and theorists. Some of them are saying what you yourself suspect, that the Pug invasion was a ploy to cause humanity to band together, learn to resolve differences without conflict and learn not to tolerate the sorts of extremism that lead to the events that precipitated the war.`
			`	Others...`
			`	You sigh deeply as you watch some paranoid fringe world politician demand that the edges of human space be better understood, that threats and even potential threats must clearly exist beyond what is already known and that it was the responsibility of the government to find out and inform the people.`
			`	Your thoughts, you keep to yourself.`
			event "hai secret leaks" 10 15
				decline

event "hai secret leaks"

mission "event: hai secret leaks A"
	landing
	source
		government "Republic" "Syndicate"
		attributes "spaceport"
	to offer
		has "event: hai secret leaks"
		not "event: hai secret leaks B: offered"
	on offer
		conversation
			`You are relaxing at the spaceport while your ship refuels after conducting a spot of business when a breaking news broadcast comes on; not urgent enough to actually interrupt scheduled content, but urgent enough to fill the first ad break.`
			`	The severe looking anchorwoman bores down the camera with an expression that demands attention.`
			`	"An ex-crewman employed by an itinerant trader has come forward to media in the Free Worlds about hostile aliens just beyond our borders! He claims to have brought video proof of an ongoing conflict that threatens to spill over and drag all of humanity back to war. Stay tuned for our full segment at 6."`
			`	You raise your eyebrows with surprise.`
			`	That such news should come out so soon after the Pug smacks of a hoax. A quick glance at the clock shows you only have ten minutes to wait so you stick around for the full segment out of curiosity.`
			`	Right on schedule the news returns with the severe anchorwoman. It turns out that the crewman in question had been picked up by a minor media outlet on Tarazed. He had apparently travelled many weeks before deciding to seek the media in order to avoid being shut down by republic intelligence if he contacted media elsewhere. The man is fairly young, and very well presented, though he has a bit of the paranoid about him that is plain to see even through a screen.`
			branch "hai knowledge"
			has "First Contact: Hai: offered"
			`	A clip of alien space ships in combat with weapons quite unlike anything produced in human space is shown, you've seen things, but not this.`
			`	It is only after this that the anchorwoman reveals that, while this was initially treated as a hoax, one of their own reporters posed a timely question to a well-respected trader and caused quite the stir when he slipped up and confirmed the existance of the aliens known as 'Hai'.`
			`	This is, of course, ridiculous... but maybe it would be good to go investigate this for yourself. You listen in to collect the relevant details for future reference.`
				decline	
			label "hai knowledge"
			`	A clip of alien space ships in combat with weapons quite unlike anything produced in human space is shown, and you recognise shield beetles hammering away at each other.`
			`	It is only after this that the anchorwoman reveals that, while this was initially treated as a hoax, one of their own reporters posed a timely question to a well-respected trader and caused quite the stir when he slipped up and confirmed the existance of the aliens known as 'Hai'.`
			`	You suspect it might be time to go visit your Hai friends again and see what's going on.`
				fail
	
mission "event: hai secret leaks B"
	landing
	source
		government "Free Worlds"
		attributes "spaceport"
	to offer
		has "event: hai secret leaks"
		not "event: hai secret leaks A: offered"
	on offer
	event "pirates investigate leaks"
		conversation
			`You are relaxing at the spaceport while your ship refuels after conducting a spot of business. On the viewscreen is some talk show or other, not something you specifically paid attention to but apparently a quite popular one out of Tarazed.`
			`	A young and fresh-faced man who looks incredibly ill at ease has just been brought out as a surprise guest by the host Jonathon Camembert.`
			`	"So now in our surprise segment let me introduce you to Ronald. He once crewed on one of these big trade ships but after seeing what he saw, he just had to come foward!"`
			`	The host stresses the word 'had' so much his voice squeeks but the audience's attention has certainly been gained.`
			`	"But first, lets take a look at a clip."`
			`	You raise your eyebrows with surprise.`
			branch "hai knowledge"
			has "First Contact: Hai: offered"
			`	A clip of alien space ships in combat with weapons quite unlike anything produced in human space is shown, you've seen things, but not this.`
			`	When it's finished the young man, who is very well presented, but clearly has a bit of the paranoid about him that is plain to see even through a screen is encouraged to talk about where he got the footage. he talks at length about an ongoing conflict that threatens to spill over and drag all of humanity back to war. A war waged by an alien species known as the 'Hai'.`
			`	This is, of course, ridiculous... but maybe it would be good to go investigate this for yourself. You listen in to collect the relevant details for future reference.`
				decline	
			label "hai knowledge"
			`	A clip of alien space ships in combat with weapons quite unlike anything produced in human space is shown, and you recognise shield beetles hammering away at each other.`
			`	When it's finished the young man, who is very well presented, but clearly has a bit of the paranoid about him that is plain to see even through a screen is encouraged to talk about where he got the footage. he talks at length about an ongoing conflict that threatens to spill over and drag all of humanity back to war. A war waged by an alien species known as the 'Hai'.`
			`	You suspect it might be time to go visit your Hai friends again and see what's going on.`
				fail

event "pirates investigate leaks"
#Spawn a small marauder fleet in Ultima Thule

#Both of these accept automatically with either secret leaks scenarios above - the non-relevant mission then fails based on whether you get the text for knowing about the Hai or not.

mission "leaks 1A: visit the hai"
	name "Visit the Hai on Allhome"
	description "It seems like events may be taking away the hai's valued secrecy, best see if things are ok."
	landing
	destination "Allhome"
	to offer
		has "event: hai secret leaks"
	to fail
		or
			has "event: hai secret leaks A: declined"
			has "event: hai secret leaks B: declined"
	to complete
		has "leaks 1B: investigate the hai: failed"
	
mission "leaks 1B: investigate the hai"
	name "Investigate the Hai"
	description "A secret and violent alien race that Traders have known about for ages? Preposterous; go find out what's really going on."
	landing
	waypoint "Ultima Thule"
	destination "Allhome"
	to offer
		has "event: hai secret leaks"
	to fail
		or
			has "event: hai secret leaks A: failed"
			has "event: hai secret leaks B: failed"
	to complete
		has "leaks 1A: visit the hai: failed"
	
	
#Branch A is if you already have Hai first contact - sends you directly to Hai Home (detour if you haven't visited Wah Ki yet).

mission "leaks 1A unfettered A"
	name "Witness the Unfettered"
	description "Turns out this endless conflict has some truth to it, go see where it's happening."
	landing
	source
		government "Hai"
		not planet "Cloudfire"
		not planet "Hai-Home"
	destination "Cloudfire"
	to offer
		has "leaks 1A: visit the hai: offered"
	on offer
		conversation
			`Landing in Hai space draws a much different type of attention than expected. Only recently you've begun to acclimate yourself to getting positive attention. As a war hero you're something of a minor celebrity now back in human space, but here suddenly mothers are keeping tight grips on their children and passers-by look upon you with a hint of wariness.`
			`	You realise that the few humans who have settled here among the Hai are all wearing pink at the moment, and when you catch the eye of one lady who looks friendly you greet them to ask a few questions.`
			choice
				`	"Why does everyone seem so afraid?"`
				`	"Why are you all wearing pink?"`
					goto pink
			`	She shakes her head and wrinkles her nose with a look of distaste, "Some marauder came here just yesterday, posing as a trader to investigate the rumours. We thought the Hai had means of keeping them out but this one snuck in and landed at the spaceport without any opposition. Then his crew kidnapped nearly four dozen Hai and hijacked a Geocoris before making off with their spoils."`
			`	She sighs deeply, "Everyone is just a bit shaken and distrustful at the moment."`
			`	"Oh that's awful!"
			`	She nods, "This is why we're all wearing pink, just a little show of local solidarity."
			goto main
			label pink
			`	A sad smile crosses her face and her expression goes sombre as she explains, "A pirate marauder snuck down onto the planet recently, stole a Geocoris and kidnapped a number of Hai, probably into slavery. Everyone is a bit shaken up so the locals are wearing pink in solidarity, and so we're not mistaken for a security risk."
			label main
			`	"Unfortunately it's taking a while for them to redistribute an appropriately resourced security force thanks to the Unfettered."
			choice
				`	"That is a serious problem." (If you already know about them.)`
				`	"Who are the Unfettered?" (Go and find out.)`
					goto rebels
			`	Your conversation is interrupted suddenly by a small group of somewhat official-looking Hai.`
			`	"Are you Captain <Last>?" one of them asks you, "Don't worry you're not in trouble or anything."`
			`	You nod your affirmation.`
			`	"Your reputation precedes you Captain, if you have any stake in the current information crisis please head directly to Hai-Home. Someone would very much like to talk to you. As a person of note, you are presently being treated as an Envoy."
			`	They leave without waiting for your agreement, but then, you did come here to see what was going on.`
				decline
			label rebels
			`	She seems surprised you asked, "Oh, they're a sort of rebel Hai group. If you don't know you should go visit Cloudfire in the Wah Ki system up north. A short visit will explain it far better than I ever could."`
				accept
	on accept
		fail "leaks 2A: envoy accepted"
	on complete
		conversation
			`You dodge the conflict in space and come in to land. Cloudfire's atmosphere is unusually hazy, with almost constant cloud cover, making agriculture unproductive here even though it is a warm and damp environment. There are several major cities here that were abandoned centuries ago, due to conflict with the Unfettered. The one major city that remains is the closest thing the Hai have to a military base, with new supplies of weapons and ammunition constantly pouring in from the rest of Hai space.`
			`The spaceport has massive hangars and advanced repair facilities designed to accommodate the largest Hai warships. Where a fleet has just returned from a recent battle, the hangars are lit with flashes from robotic welders as damaged hull plates are swapped out for fresh ones and weakened joints are reinforced. The actual process of building these warships, however, takes place on the Hai homeworld, where the facilities will not be vulnerable to attack.`
			`It does not take long to realise that this conflict really is constant, even if the friendlier Hai on this side seem to be maintaining their defence without apparently taxing their civilisation to any great extent.`
	
	
#This fires at the same time as leaks "1A unfettered A" and takes you to Hai-Home if you don't need to visit Cloudfire.
mission "leaks 2A: envoy accepted"
	name "Head directly to Hai-Home"
	description "Go to Hai-Home, go directly to Hai-Home, do not pass Go or collect $200."
	landing
	source
		government "Hai"
		not planet "Cloudfire"
		not planet "Hai-Home"
	destination "Hai-Home"
	to offer
		has "leaks 1A: visit the hai: offered"
	to fail
		or
			has "leaks 1A unfettered A: done"
			has "leaks 1A unfettered A: active"
	to complete
		has "leaks 1A unfettered A: declined"
	
#This fires after you've visited Cloudfire to learn about the Unfettered
mission "leaks 2B: envoy accepted"
	name "Head directly to Hai-Home"
	description "Go to Hai-Home, go directly to Hai-Home, do not pass Go or collect $200."
	landing
	source
		planet "Cloudfire"
	destination "Hai-Home"
	to offer
		has "leaks 1A: visit the hai: offered"
	to fail
		or
			has "leaks 1A unfettered A: done"
			has "leaks 1A unfettered A: active"
	to complete
		has "leaks 1A unfettered A: declined"
	
	
#Branch B is if you haven't met the Hai before, fires after First contact happens, sends you on a short guided tour of Hai space.
	
	#Stop 1 Imo Dep (Stonebreak)
	
	#Stop 2 Alta Hai (ringworld)
	
	#Stop 3 Wah Ki (Cloudfire)
	
	
	#Make reference to them finding out your status from the war, and your visitation of Hai space
	
#Branches merge here.
	
mission "leaks response 1"
	landing
	source
		"Hai-Home"
	destination 
		"Earth"
	to offer
		or
			has "leaks 2A: envoy accepted: accepted"
			has "leaks 2B: envoy accepted: accepted"
	on offer
		conversation
			`As you come into land on Hai-Home you find that a reasonable security detachment has been assigned to your designated landing berth. The Hai aren't usually ones to be concerned about such things, but you suspect that as an apparent "war hero" that this may be more for the benefit of appearances on your part than anything else.`
			`	Word of your status in human space seems to have spread ahead of you, especially with you beng known on many Hai worlds as one of the view significant human visitors. A small crowd of Hai have gathered to peek at you on the short walk from the Spaceport to the government building you are led to.`
			branch karma
			karma > 1
			`	As you are making the walk you hear questions posed and rumours stated. Occasionally you hear words like "survivor" and "dangerous" thrown in amongst the babble.`
			goto main
			label karma
			`	As you are making the walk you hear questions posed and rumours stated. Occasionally you hear words like "honourable" and "reasonable" thrown in amongst the babble.`
			label main
			`	You are eventually led into a very comfortable office where you are received by a mature looking Hai with the apropriate regalia of a diplomat. She holds out a paw to greet you, and says, "My name is Sayari. I was the envoy to the human government, a century ago."`
			`	The present media storm is all the evidence you need to know the Republic has never mentioned the Hai, nor publicly acknowledged receiving an envoy from them. If they're in on the secret, then it makes sense that they're probably still trying to work out a suspression strategy and too busy to have sent an envoy quicker than yourself.`
			`	After a moment to let you ponder, she continues, "Our reports tell us that you are a well-known individual, respected both by your own government and abroad in the other human governments. Our reports also tell us that 'Hai' is quickly becoming a buzzword in your space. A few traders brought the news ahead of you."`
			`	She pauses and looks at you seriously.`
			`	"We think it would be prudent for you to represent your people as our point of contact. Would you accept such a role?"`
			`You give it a moment of thought.`
			choice
				`	"It certainly seems rather practical."`
			`	"Fantastic," she says, though her tone is much more business like than the wording would imply, "In that case, if you could please take this to Earth and communicate with your various governments we can begin a dialogue on how best to deal with this current scenario."`
			`	Your take the boxed item with you and an escort awaits to return you to your ship. As the door behind you closes you are sure you hear Sayari mutter to someone, "It was really much easier when they just had one government, what a mess."`
				accept
	
	
mission "leaks response 2"
	landing
	source "Earth"
	stopover "Deep"
	stopover "Foundry"
	destination "Hai-Home"
	to offer
		has "leaks response 1: offered"
	passengers 3
	on offer
		event "pirates respond to leaks"
		conversation
			`On approach to the spaceport on Earth you communicate your need to speak to an official of significant standing on diplomatic business. Since you are not a diplomat this does cause some minor kerfuffle in the process, but thanks to your renown from the Pug war you are able to blow past such petty objections sufficiently so as to shortcut the process. The diplomatic ID from the box Sayari gave you doesn't hurt either.`
			`	The Republic Deputy Minister for Foreign Affairs meets you in a hired, private room at the spaceport.`
			`	"Captain <Last>," he steps around the table to grasp your hand in a firm handshake, "Xilin Yang, it's an honour to meet a war hero like yourself."`
			choice
				`	"It was a brutal business, but someone had to do it. For the people."`
				`	"Please, it was far less dramatic than it's made out to be."`
				goto humble
			`	You play the part and do your best attempt at looking noble. Mr Yang seems more than happy to embody respect for the hero of his preferred narrative.`
			`	"You're every inch what I expected," he assures you before moving to take his seat.`
			goto sit
			label humble
			`	You spread your hands in an appeasing gesture and explain, "You should listen to the xenoanthropologists, the Pug really were just here to test us, to make us really consider what mattered to our species."`
			`	For a moment his expression falters and then he seems almost relieved, "You may be a better man than I expected to meet."`
			`	He offers you a genuine smile as he takes his seat.`
			label sit
			`	You take your seat opposite him and you get down to business. You explain how the Hai have proposed you be their official contact point for humanity on account of your fame from the war.`
			`	He asks a few questions for clarity and when you're done he requests if you'd kindly wait for a moment while he makes a call. It is a lengthy wait, and at one point an aide comes in and offers you refreshments while deliberations continue elsewhere. Much to your surprise the fruity beverage is actually quite light and not too sweet, reminding you briefly that this is actually the world where your major foods originally evolved. 
			`	Eventually Mr Yang returns, "So sorry for that, I hope you were looked after suitably while you waited."`
			`	Once you nod your assent he continues, "Well, obviously the Republic knows about the Hai, but for the moment our official line is that the government does not trade in rumours. However, clearly an appropriate response is needed. I have been informed that Republic Intelligence has gone through official channels to brief the Free Worlds Council just yesterday. They have demanded that they have a trained diplomatic representative along for any decisions. This is already standard practice for the Syndicate. If you are willing, I will come with you, and we shall meet two individuals known as Katya and Alastair on Deep and Foundry respectively. I believe you already know them?`
			`	You indicate as such.`
			`	"Excellent, in that case we should go to Deep first for speed, shall we be off?"`
				accept
	on stopover
		conversation
			`Landing on Foundry you are communicated to on a private encrypted channel and directed to a private hangar where you are greeted personally by CEO Alastair Korban.`
			`	He smiles warmly, "Apologies Captain <Last>, do excuse the cloak and dagger, but in the current media climate you and I are both too well known to be seen meeting without causing the rumour mill to grind out a new story."`
			`	"Now, allow me to introduce you to my protege Terry Adrianopolous, he will be accompanying you as the Syndicate representative."`
			`	The young woman goes from calculating to gregarious in the blink of an eye as your attention shifts to her. She's pleasant and approachable, and very articulate, but from your brief glimpse beforehand you have no doubt she's cut from the sort of cloth that makes her future CEO material. You resolve not to get on her bad side if at all possible.`
			`"Oh by the way," says Alastair, pausing briefly as he turns to depart, "The navy and my security forces are working jointly to get some of our message relays up in the far north to link through Ultima Thule. The pirates are wont to destroy them whenever they find them but we should be able to rely on at least basic communication to get through if you need it. Rather than flying back and forth for literally every question. That's all."
			`After which he finally, actually, departs for good.`
	on visit
		dialog phrase "generic stopover on visit"
	on complete
		conversation
			`You are directed to an official landing pad on your return to Hai-Home and it is not long before you are introducing your entourage to Sayari. Alondo in particular seems quite stoked to be here and seems to have a knack for charming Sayari with polite and insightful, if rather simple, questions throughout the diplomatic niceties.`
			`	You get down to business at the moment Sayeri inquires how your journey went.`
			choice
				`I don't recall there being nearly so many pirates.'
			`	Sayari frowns and exhales a long breath through her nose, "Yes. Well it seems that the rumours of us, and the information making its way through your media has attracted every opportunist this side of the Deep."`
			`	"Of course," she says, "some of the pirates were aware of us, and we were aware of them being aware of us. We had a quiet arrangement with a select few where we rewarded them for keeping the secret well contained within their own circles."`
			`	Alondo looks surprised, but Mr Yang and Ms Adrianopolous both merely nod sagely.`
			`	"Extra security forces are being called in, but we've been busier in Wah Ki than usual lately."`
			`	Mr Yang pulls out a datapad, "Well then I'm afraid I may have some bad news. May I?"`
			`	He gestures to a display and then takes control when indicated.`
			`	"One of the things I brought with me was Republic Intelligence's estimate of the effectiveness of various information containment measures."`
			`	A series of charts are thrown up on the screen. You're not an expert at reading this sort of data but highlighted percentages ranging from as low as 4% to only as high as 39% do not look promising. The final graphic is a map of stages of what is labelled as 'artifact penetration'.`
			`	"Artifact penetration is the point at which a government cannot reasonably attempt to pretend something is other than the truth, at least not while still holding to the claim of being a representative government," explains Mr Yang.`
			`	He checks the date, "Our most optimistic estimates suggest the Republic will be forced to acknowledge the existence of the Hai within three months or lose so much credibility as to compromise elctoral stability, the actual time limit is probably sooner."
			choice
				`Would that be so bad?`
			`"It is always bad to be forced into acknowledging a secret, if we act sooner we may control the manner of that secret's release.`
			`Sayari looks at you, "We will have to come up with a plan, and quickly, but for the moment may I ask a favour of the war hero in the room? Please meet up with the security forces converging on Allhome, help them route the pirates back to the other side of the wormhole it will buy us some breathing space and some options."`
			`It is so hard to say no to a Hai and their cute squirrelly features.`
			choice
				`"I'll do what I can."
#If a republic/syndicate campaign gets added this on complete text will need variants.
	
	
event "pirates respond to leaks"
	#Add pirate spawns to Waypoint and Heia Due
	
	
#If a republic/syndicate campaign gets added this text will need variants.
mission "leaks response 2A"
	landing
	invisible
	source Deep
	to offer
		has "leaks response 2: active"
	on offer
		conversation
			`When you land on Deep Katya is there waiting for you along with Alondo, "<First> it's so good to see you again! When the Republic briefed the council we were very concerned by the lack of ability to reach you, but of course you would somehow manage to be in the thick of it before we even knew what was going on."`
			`	You hug them both in turn and return the greeting as you look from one to the other, "I thought it seemed odd when they said I was meeting you for this Katya, but it makes much more sense if you were just easier to get a hold of than ALondo here."`
			`	"Oh it was always going to be Alondo," she says, "but there's never a bad excuse for travelling with an old friend, especially when you're meeting other friends too."`
			`	"Do we have time for a drink before we must rush off?" asks Alondo.`
			`	You look around at the busy spaceport, no one has even begun looking at your ship for refueling.`
			`	"I think we can spare a short while, and you really should meet Mr Yang."`
			`	Mr Yang had been studiously pretending he wasn't eavesdropping from a distance of a few metres, but before you can call him over Alondo's slightly suggestive comment of 'Oh I should definitely meet Mr Yang' had evidently been overheard.`
			`	Fortunately, after an hour and a couple of drinks, all embarrassment has been forgotten on both sides by the time you're returning to your ship.`
				decline
	
mission "leaks response 2B"
	landing
	source
		government "Republic" "Syndicate" "Free Worlds"
	to offer
		has "leaks response 2: active"
	on offer
		conversation
			`While refuelling on <origin> you see that the media circus is continuing uabated. Apparently pirates have started making renewed attacks on trade lanes in the north, utilising some of the strange weapons observed in the recorded clip of Hai ships fighting each other. Goodness knows how they got their hands on them, but it can't be good news.`
				decline


mission "leaks response 3"
#This gets picked up silently on Hai-Home when landing for response 2 - go kill pirates, stopover chat on Allhome.


			`	She looks surprised, "Didn't you see the pirates on your way in? They've been appearing en masse and overhwelming security forces to raid technology and goods from the Hai traders and their security. Some of them have even been sneaking down onto the planet and capturing Hai, taking them away to goodness only knows where."`
			`	"Oh I didn't realise it was so bad!"
			`	She nods, "This is why we're all wearing pink, just a little show of local solidarity."
			goto main
			label pink
			`	A sad smile crosses her face and her expression goes sombre as she explains, "The pirate marauders that have recently come have been sneaking down onto the planet and kidnapping Hai, probably into slavery. The locals are wearing pink in solidarity, and so we're not mistaken for a security risk."
			label main
			`	"Unfortunately it's taking a while for them to redistribute an appropriately resourced defence force thanks to the Unfettered."
